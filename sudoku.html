<!DOCTYPE html>
<html ng-app="testApp">
<head>
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <title>SUDOKU!!!!</title>
</head>
<body ng-controller="testCtrl">

	<div ng-repeat="row in storage" >
		<div ng-repeat="block in row" 
		class="square" onclick="modifyBlock(this);" id="{{block.x}}{{block.y}}"><span ng-style="set_bold({{block}})" >{{block.value}}</span></div>
	</div>
	<script>

		document.addEventListener('keydown', function(event) {
		    if(event.keyCode >= 49 && event.keyCode<=57) {
		        if(currDiv){
		        	var scope = angular.element(document.body).scope();
		        	scope.$apply(function(){
		        		var pos = currDiv.id;
		        		if(scope.storage[pos.charAt(0)][pos.charAt(1)].change){
		        			currDiv.innerHTML=event.keyCode-48;
		        			scope.storage[pos.charAt(0)][pos.charAt(1)].value = event.keyCode-48;
		        			//CHECK FOR FINISH!!!
						    var board = scope.storage;
						    if(checkBoard(board))
						    	alert("YOU WON!");
		        		}
				    });
		       	}
		    }
		});



		function checkBoard(board){
			//CHECK ALL THE ROWS
			for(var x=0;x<board[0].length;x++){
				var total = [false, false, false, false, false, false, false, false, false];
				for(var y=0;y<board.length;y++)
				    total[board[x][y].value-1]=true;
				if(!(total[0] && total[1] && total[2] && total[3] && total[4] && total[5] && total[6] && total[7] && total[8])){
				    return false;
				}
			}
			//CHECK ALL THE COLUMNS
			for(var y=0;y<board.length;y++){
				var total = [false, false, false, false, false, false, false, false, false];
				for(var x=0;x<board[0].length;x++)
				    total[board[x][y].value-1]=true;
				if(!(total[0] && total[1] && total[2] && total[3] && total[4] && total[5] && total[6] && total[7] && total[8]))
				    return false;
			}
			//CHECK ALL THE 9 BOXES
			for(var x=0;x<board[0].length;x+=3){
				var total = [false, false, false, false, false, false, false, false, false];
				for(var y=0;y<board.length;y+=3){
				    total[board[x][y].value-1]=true;
				    total[board[x][y+1].value-1]=true;
				    total[board[x][y+2].value-1]=true;
				    total[board[x+1][y].value-1]=true;
				    total[board[x+1][y+1].value-1]=true;
				    total[board[x+1][y+2].value-1]=true;
				    total[board[x+2][y].value-1]=true;
				    total[board[x+2][y+1].value-1]=true;
				    total[board[x+2][y+2].value-1]=true;
					if(!(total[0] && total[1] && total[2] && total[3] && total[4] && total[5] && total[6] && total[7] && total[8]))
					    return false;
				}
			}
			return true;
		}
		var currDiv;
		function modifyBlock(item){
			if(currDiv==item){
				currDiv.setAttribute('style','color: black');
				currDiv = undefined;
			}
			else{
				if(currDiv)
					currDiv.setAttribute('style','color: black');
				currDiv = item;
				item.setAttribute('style', 'color: blue');
			}
		}
	</script>
    <script src="angular.min.js"></script>
    <script src="ctrl1.js">
	</script>
</body>

</html>